
build/Motor_Driver.elf:     file format elf32-littleriscv


Disassembly of section .init:

00000000 <InterruptVector>:
   0:	0a00006f          	j	a0 <_einit>
   4:	00000000          	.word	0x00000000
   8:	0000011c          	.word	0x0000011c
   c:	0000011a          	.word	0x0000011a
	...
  30:	0000011a          	.word	0x0000011a
  34:	00000000          	.word	0x00000000
  38:	0000011a          	.word	0x0000011a
  3c:	00000000          	.word	0x00000000
  40:	0000011a          	.word	0x0000011a
  44:	0000011a          	.word	0x0000011a
  48:	0000011a          	.word	0x0000011a
  4c:	0000011a          	.word	0x0000011a
  50:	0000011a          	.word	0x0000011a
  54:	0000011a          	.word	0x0000011a
  58:	0000011a          	.word	0x0000011a
  5c:	0000011a          	.word	0x0000011a
  60:	0000011a          	.word	0x0000011a
  64:	0000011a          	.word	0x0000011a
  68:	0000011a          	.word	0x0000011a
  6c:	0000011a          	.word	0x0000011a
  70:	0000011a          	.word	0x0000011a
  74:	0000011a          	.word	0x0000011a
  78:	0000011a          	.word	0x0000011a
  7c:	0000011a          	.word	0x0000011a
  80:	0000011a          	.word	0x0000011a
  84:	0000011a          	.word	0x0000011a
  88:	0000011a          	.word	0x0000011a
  8c:	0000011a          	.word	0x0000011a
  90:	0000011a          	.word	0x0000011a
  94:	0000011a          	.word	0x0000011a
  98:	0000011a          	.word	0x0000011a
  9c:	0000                	.insn	2, 0x
	...

Disassembly of section .text:

000000a0 <handle_reset>:
  a0:	20000197          	auipc	gp,0x20000
  a4:	76018193          	addi	gp,gp,1888 # 20000800 <_eusrstack>
  a8:	00018113          	mv	sp,gp
  ac:	08000513          	li	a0,128
  b0:	30051073          	csrw	mstatus,a0
  b4:	468d                	li	a3,3
  b6:	00000517          	auipc	a0,0x0
  ba:	f4a50513          	addi	a0,a0,-182 # 0 <InterruptVector>
  be:	8d55                	or	a0,a0,a3
  c0:	30551073          	csrw	mtvec,a0
  c4:	20000517          	auipc	a0,0x20000
  c8:	f3c50513          	addi	a0,a0,-196 # 20000000 <_data_vma>
  cc:	20000597          	auipc	a1,0x20000
  d0:	f3458593          	addi	a1,a1,-204 # 20000000 <_data_vma>
  d4:	4601                	li	a2,0
  d6:	00b55663          	bge	a0,a1,e2 <handle_reset+0x42>
  da:	c110                	sw	a2,0(a0)
  dc:	0511                	addi	a0,a0,4
  de:	feb54ee3          	blt	a0,a1,da <handle_reset+0x3a>
  e2:	26800513          	li	a0,616
  e6:	20000597          	auipc	a1,0x20000
  ea:	f1a58593          	addi	a1,a1,-230 # 20000000 <_data_vma>
  ee:	20000617          	auipc	a2,0x20000
  f2:	f1260613          	addi	a2,a2,-238 # 20000000 <_data_vma>
  f6:	00c58863          	beq	a1,a2,106 <handle_reset+0x66>
  fa:	4114                	lw	a3,0(a0)
  fc:	c194                	sw	a3,0(a1)
  fe:	0511                	addi	a0,a0,4
 100:	0591                	addi	a1,a1,4
 102:	fec59ae3          	bne	a1,a2,f6 <handle_reset+0x56>
 106:	e000f7b7          	lui	a5,0xe000f
 10a:	4715                	li	a4,5
 10c:	c398                	sw	a4,0(a5)
 10e:	18c00793          	li	a5,396
 112:	34179073          	csrw	mepc,a5
 116:	30200073          	mret

0000011a <ADC1_IRQHandler>:
 11a:	a001                	j	11a <ADC1_IRQHandler>

0000011c <NMI_Handler>:
 11c:	40021737          	lui	a4,0x40021
 120:	471c                	lw	a5,8(a4)
 122:	008006b7          	lui	a3,0x800
 126:	8fd5                	or	a5,a5,a3
 128:	c71c                	sw	a5,8(a4)

0000012a <SystemInit>:
 12a:	400227b7          	lui	a5,0x40022
 12e:	4705                	li	a4,1
 130:	c398                	sw	a4,0(a5)
 132:	400217b7          	lui	a5,0x40021
 136:	01080737          	lui	a4,0x1080
 13a:	0007a223          	sw	zero,4(a5) # 40021004 <_eusrstack+0x20020804>
 13e:	08170713          	addi	a4,a4,129 # 1080081 <Motor_Driver.c.3b204827+0x107e42f>
 142:	c398                	sw	a4,0(a5)
 144:	009f0737          	lui	a4,0x9f0
 148:	c798                	sw	a4,8(a5)
 14a:	40021737          	lui	a4,0x40021
 14e:	431c                	lw	a5,0(a4)
 150:	00679693          	slli	a3,a5,0x6
 154:	fe06dde3          	bgez	a3,14e <SystemInit+0x24>
 158:	435c                	lw	a5,4(a4)
 15a:	400216b7          	lui	a3,0x40021
 15e:	9bf1                	andi	a5,a5,-4
 160:	0027e793          	ori	a5,a5,2
 164:	c35c                	sw	a5,4(a4)
 166:	4721                	li	a4,8
 168:	42dc                	lw	a5,4(a3)
 16a:	8bb1                	andi	a5,a5,12
 16c:	fee79ee3          	bne	a5,a4,168 <SystemInit+0x3e>
 170:	e00007b7          	lui	a5,0xe0000
 174:	0f878793          	addi	a5,a5,248 # e00000f8 <_eusrstack+0xbffff8f8>
 178:	0007a023          	sw	zero,0(a5)
 17c:	e00007b7          	lui	a5,0xe0000
 180:	0f478793          	addi	a5,a5,244 # e00000f4 <_eusrstack+0xbffff8f4>
 184:	08000713          	li	a4,128
 188:	c398                	sw	a4,0(a5)
 18a:	8082                	ret

0000018c <main>:
/// @return none
void pwm_set_duty(uint32_t val);

/*** Main ********************************************************************/
int main()
{
 18c:	1151                	addi	sp,sp,-12
 18e:	c406                	sw	ra,8(sp)
	SystemInit();
 190:	3f69                	jal	12a <SystemInit>
#endif

void DelaySysTick( uint32_t n )
{
#ifdef CH32V003
	uint32_t targend = SysTick->CNT + n;
 192:	e000f7b7          	lui	a5,0xe000f
 196:	4798                	lw	a4,8(a5)
 198:	004947b7          	lui	a5,0x494
 19c:	e0078793          	addi	a5,a5,-512 # 493e00 <Motor_Driver.c.3b204827+0x4921ae>
 1a0:	973e                	add	a4,a4,a5
	while( ((int32_t)( SysTick->CNT - targend )) < 0 );
 1a2:	e000f6b7          	lui	a3,0xe000f
 1a6:	469c                	lw	a5,8(a3)
 1a8:	8f99                	sub	a5,a5,a4
 1aa:	fe07cee3          	bltz	a5,1a6 <main+0x1a>
// TODO: Set mode 1, invert val

void pwm_init(void)
{
	// Enable TIM2 Clock	
	RCC->APB1PCENR |= RCC_APB1Periph_TIM2;
 1ae:	400217b7          	lui	a5,0x40021
 1b2:	4fd8                	lw	a4,28(a5)

	// Enable GPIOD Clock
	RCC->APB2PCENR |= RCC_APB2Periph_GPIOD;
	// Reset PORTD-4, then set to 10-MHz, Push-Pull, Alternate Function
	GPIOD->CFGLR &= ~(0xf<<(4*4));
 1b4:	fff10637          	lui	a2,0xfff10
 1b8:	167d                	addi	a2,a2,-1 # fff0ffff <_eusrstack+0xdff0f7ff>
	RCC->APB1PCENR |= RCC_APB1Periph_TIM2;
 1ba:	00176713          	ori	a4,a4,1
 1be:	cfd8                	sw	a4,28(a5)
	RCC->APB2PCENR |= RCC_APB2Periph_GPIOD;
 1c0:	4f98                	lw	a4,24(a5)
}


void pwm_set_duty(uint32_t val)
{
	TIM2->CH1CVR = val;
 1c2:	40000537          	lui	a0,0x40000
	uint32_t targend = SysTick->CNT + n;
 1c6:	e000f5b7          	lui	a1,0xe000f
	RCC->APB2PCENR |= RCC_APB2Periph_GPIOD;
 1ca:	02076713          	ori	a4,a4,32
 1ce:	cf98                	sw	a4,24(a5)
	GPIOD->CFGLR &= ~(0xf<<(4*4));
 1d0:	40011737          	lui	a4,0x40011
 1d4:	40070713          	addi	a4,a4,1024 # 40011400 <_eusrstack+0x20010c00>
 1d8:	4314                	lw	a3,0(a4)
		for(uint32_t x = 0; x < 1024; x++) {
 1da:	40000313          	li	t1,1024
	GPIOD->CFGLR &= ~(0xf<<(4*4));
 1de:	8ef1                	and	a3,a3,a2
 1e0:	c314                	sw	a3,0(a4)
	GPIOD->CFGLR |= (GPIO_Speed_10MHz | GPIO_CNF_OUT_PP_AF)<<(4*4);
 1e2:	4314                	lw	a3,0(a4)
 1e4:	00090637          	lui	a2,0x90
 1e8:	8ed1                	or	a3,a3,a2
 1ea:	c314                	sw	a3,0(a4)
	RCC->APB1PRSTR |= RCC_APB1Periph_TIM2;
 1ec:	4b98                	lw	a4,16(a5)
 1ee:	00176713          	ori	a4,a4,1
 1f2:	cb98                	sw	a4,16(a5)
	RCC->APB1PRSTR &= ~RCC_APB1Periph_TIM2;
 1f4:	4b98                	lw	a4,16(a5)
 1f6:	9b79                	andi	a4,a4,-2
 1f8:	cb98                	sw	a4,16(a5)
	TIM2->PSC = 0x0000;
 1fa:	400007b7          	lui	a5,0x40000
 1fe:	02079423          	sh	zero,40(a5) # 40000028 <_eusrstack+0x1ffff828>
	TIM2->ATRLR = 1023;
 202:	3ff00713          	li	a4,1023
 206:	02e79623          	sh	a4,44(a5)
	TIM2->CHCTLR1 |= TIM_OC1M_2 | TIM_OC1M_1 | TIM_OC1M_0 | TIM_OC1PE;
 20a:	0187d703          	lhu	a4,24(a5)
 20e:	07876713          	ori	a4,a4,120
 212:	00e79c23          	sh	a4,24(a5)
	TIM2->CTLR1 |= TIM_ARPE;
 216:	0007d703          	lhu	a4,0(a5)
 21a:	08076713          	ori	a4,a4,128
 21e:	00e79023          	sh	a4,0(a5)
	TIM2->CCER |= TIM_CC1E | TIM_CC1P;
 222:	0207d703          	lhu	a4,32(a5)
 226:	00376713          	ori	a4,a4,3
 22a:	02e79023          	sh	a4,32(a5)
	TIM2->SWEVGR |= TIM_UG;
 22e:	0147d703          	lhu	a4,20(a5)
 232:	00176713          	ori	a4,a4,1
 236:	00e79a23          	sh	a4,20(a5)
	TIM2->CTLR1 |= TIM_CEN;
 23a:	0007d703          	lhu	a4,0(a5)
 23e:	00176713          	ori	a4,a4,1
 242:	00e79023          	sh	a4,0(a5)
 246:	00075737          	lui	a4,0x75
 24a:	30070713          	addi	a4,a4,768 # 75300 <Motor_Driver.c.3b204827+0x736ae>
		for(uint32_t x = 0; x < 1024; x++) {
 24e:	4781                	li	a5,0
	TIM2->CH1CVR = val;
 250:	d95c                	sw	a5,52(a0)
 252:	4590                	lw	a2,8(a1)
 254:	963a                	add	a2,a2,a4
	while( ((int32_t)( SysTick->CNT - targend )) < 0 );
 256:	4594                	lw	a3,8(a1)
 258:	8e91                	sub	a3,a3,a2
 25a:	fe06cee3          	bltz	a3,256 <main+0xca>
		for(uint32_t x = 0; x < 1024; x++) {
 25e:	0785                	addi	a5,a5,1
 260:	fe6798e3          	bne	a5,t1,250 <main+0xc4>
 264:	b7ed                	j	24e <main+0xc2>
	...
